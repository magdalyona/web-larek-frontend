# Проектная работа "Web-ларек" - 

этот интернет-магазин для веб-разработчиков предлагает удобный каталог товаров, корзины и процесс оформления заказа с поэтапной проверкой введенных данных.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения 

Проект построен на основе архитектурного паттерна MVP (Model-View-Presenter), благодаря чему достигается низкая связанность компонентов и возможность легко масштабировать систему.

MVP - это архитектурная модель, которая разделяет приложение на три основных слоя:

- Model (Модель) - отвечает за управление данными и бизнес-логику приложения;

- View (Представление) - отвечает за отображение данных для пользователей;

- Presenter (Представитель) - это промежуточный слой между Model и View, который обрабатывает действия пользователя поступающие из View и обновляя данные в Model, а также отслеживает изменения в Model и своевременно обновляет интерфейс View.

## Базовый код

### Class API

Базовый класс API обеспечивает функциональность для работы сервера (отправка и получение запросов). 

#### Свойства:

    - baseUrl: базовый URL для работы с API.
    - options: объект с настройками для HTTP-запроса.

#### Методы: 

    - handleResponse: обрабатывает ответ от API, преобразует и возвращает его.
    - get: выполняет GET-запрос по указанному URL.
    - post: выполняет POST-запрос по указанному URL.

### Class EventEmitter

Брокер событий используется в presenter для отправления событий и подписки на события, происходящие в системе. Класс используется для связи слоя данных и представления.

#### Свойства:

    - events: хранит события и их подписчиков.

#### Методы: 

    - on() - устанавливает обработчик на указанное событие;
    - off() - удаляет обработчик с указанного события;
    - emit() - инициирует событие с указанными данными;
    - onAll() - устанавливает обработчик для всех событий;
    - offAll() - все обработчики событий срабатывают;
    - trigger() - создает функцию-триггер, которая инициирует указанное событие при вызове;

### Class Component

Абстрактный класс, предоставляющий базовые методы для работы с DOM-элементами и управления их состоянием.

constructor(container: HTMLElement) - контейнер, который является корневым DOM-элементом, в который будет помещен компонент;

#### Методы: 

    - toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает класс элемента;
    - protected setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое;
    - setDisabled(element: HTMLElement, state: boolean) - устанавливает состояние блокировки;
    - protected setHidden(element: HTMLElement) - скрывает элемент;
    - protected setVisible(element: HTMLElement) - показывает элемент;
    - protected setImage(element: HTMLImageElement, src: string, alt?: string) - установить изображение с алтернативным текстом;
    - render(data?: Partial): HTMLElement - возвращает DOM-элемент;


## Model (Модели данных) 

### Class LarekApi

Класс отвечает за работу с сервером в приложении. Наследует базовый класс Api, что позволяет использовать и дополнять его функционал.

#### Свойства:

    - cdn — хранит входящий url;

#### Методы: 

    - getProductList — метод для получения списка товаров с сервера;
    - getProduct - метод для получения одного товара;
    - orderDataProducts — метод для отправки данных заказа на сервер;

### Class AppData

Содержит в себе все основные группы данных страницы и методы работы с ними.

#### Свойства:

    - catalog - для данных списка товаров;
    - preview - для данных предпросмотра товара;
    - basket - для данных корзины покупок;
    - order - для данных заказа, который отправляется на сервер;
    - formErrors - для данных ошибок формы;

#### Методы: 

    - setProducts — установка карточек в каталог;
    - setOrderField - для установки поля заказа;
    - setContactsField - для установки поля контактов;
    - addProductBasket — добавление товара в корзину;
    - deleteProductBasket — удаление товара из корзины;
    - setPreview - установка данных в превью;
    - checkIdInbasket - проверка добавлен товар в корзину;
    - clearBasket - очистка корзины;
    - checkValidAddress - валидация первого шага заказа;
    - checkValidContact — валиадация полей второго шага заказа;
    - clearInputOrder — очищение полей формы заказа;


## View (Представления)

### Class Page

Класс отвечает за управление состоянием страницы, отображение корзины и подсчет товаров в ней.

constructor(container: HTMLElement, protected events: IEvents):

    - принимает container типа HTMLElement и объект event типа IEvent
    - передает container в родительский конструктор
    - сохраняет необходимые элементы разметки в полях
    - вешает на кнопку корзины _basket слушатель события click, при котором регистрируется событие basket:open

#### Свойства:

    - protected _counter: HTMLElement - счетчик товаров в корзине;
    - protected _catalog: HTMLElement - каталог с карточками товара;
    - protected _wrapper: HTMLElement - состояние обертки страницы;
    - protected _basket: HTMLElement - корзина на странице;

#### Методы: 

    - set counter(value: number) - обновляет счетчик товаров в корзине;
    - set catalog(items: HTMLElement[]) - меняет содержимое каталога;
    - set locked(value: boolean) - меняет класс обёртки;

### Class Product

Класс отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, описания, цены, категории и кнопку. Так же в классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия пользователя, генерируются соответствующие события. Также в классе есть сеттеры и геттеры для установки и получения значений.

#### Свойства:

    - title - хранит разметку заголовка товара;
    - description - хранит описание товара;
    - price - хранит разметку цены товара;
    - category - хранит разметку категории товара;
    - image - хранит разметку изображения товара;
    - button - хранит кнопку товара;

#### Методы: 

    set title — установка содержимого заголовка;
    set category — установка содержимого категории;
    set image — установка содержимого изображения;
    set price — установка содержимого цены;
    set id - установка id товара;

### Class Basket

Класс отвечает за отображение корзины товаров. 

constructor(container: HTMLElement, protected events: EventEmitter) - принимает корневой элемент для корзины и объект событий;

#### Свойства:

    - protected _list: HTMLElement - элемент, содержащий список товаров в корзине
    - protected _total: HTMLElement - элемент, отображающий общую стоимость товаров в корзине
    - protected _button: HTMLElement - элемент, представляющий кнопку действия

#### Методы: 

    - set total(total: number): void - меняет значение суммы
    - set items(items: HTMLElement[]): void - меняет содержимое корзины
    - set selected(items: string[]):void; - меняет активность кнопки

### Class Form

Расширяет класс Component, предназначен для реализации модального окна с формой ввода данных пользователя.

constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает контейнер с элементами формы, объект событий, используемый для всех полей ввода и кнопки отправки формы;

#### Свойства:

    - protected _submit: HTMLButtonElement - кнопка отправки формы
    - protected _errors: HTMLElement - элемент для отображения ошибок валидации форм ввода

#### Методы: 

    - protected onInputChange(field: keyof T, value: string) - регистрирует событие с именем конкретного поля;
    - set valid(value: boolean) - устанавливает состояние валидности формы. Если форма не валидна, кнопка отправки формы становится неактивной;
    - set errors(value: string) - устанавливает текст ошибок ввода в элемент _errors;
    - render(state: Partial & IFormState) - рендерит форму с переданными данными и состоянием валидности;


### Class OrderForm

Класс реализует работу с формой оплаты. Предоставляет возможность взаимодействия с данными формы.

constructor(container: HTMLFormElement, events: IEvents) - принимает контейнер с формой и брокер событий;

#### Методы: 

    - set adress(value: string) - устанавливает адрес доставки;
    - set payment(value: TPayment) - устанавливает способ оплаты;

### Class ContactsForm

Класс реализует работу с формой контактов,  а именно ввод почты и телефона.

constructor(container: HTMLFormElement, events: IEvents) - принимает контейнер с формой и брокер событий;

#### Методы: 

- set phone — устанавливает значение телефона;
- set email — устанавливает значение почты;

### Class Modal

Класс предназначен для управления модальными окнами. Методы open и close используются для управления отображением модального окна.

constructor(container: HTMLElement, protected events: IEvents) - конструктор принимает контейнер и экземпляр класса `EventEmitter` для возможности инициализации событий;

#### Методы: 

    - open: открывает модальное окно;
    - close: закрывает модальное окно;
    - setContent: устанавливает содержимое модального окна;
    - render: рендерит модальное окно на странице;


### Class Success

Класс отображает успешное завершение оформления заказа.

- constructor(container: HTMLElement, actions: ISuccessActions) - в конструкторе есть: элемент, в котором будет размещен компонент и объект, содержащий действия, которые могут быть выполнены в ответ на события в компоненте.

#### Свойства:

    - total: элемент, который отображает общую сумму покупки;
    - close: кнопка для подтверждения оформления заказа и закрытия окна;


## Presenter (Взаимодействие компонентов) 

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера. 
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts 
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## События в приложении

    - card:select - выбор карточки;
    - modal:open - открытие модального окна;
    - modal:close - закрытие модального окна;
    - basket:open - открытие корзины;
    - order:open - подтверждение товаров в корзине;
    - order:ready - готовность заказа;
    - basket:change - изменение списка товаров в корзине;
    - items:change - изменение массива товаров каталога;
    - preview:change - изменение товара в модальном окне;
    - formErrors:changed - изменение состояния валидации форм;


